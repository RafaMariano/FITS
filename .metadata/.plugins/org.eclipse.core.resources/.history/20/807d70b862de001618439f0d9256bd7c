package br.inpe.log;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.util.Date;


public class Log {
	
	private File log = new File("/home/inpe/log/log.txt");
	private static Log logSingleton;

//	public Log(String msgError, String classError){
//		this.log = 
//		this.msgError = msgError;
//		this.classError = classError;
//	}

	private Log(){}
	
	public static synchronized Log getInstance(){
		if (logSingleton == null)
			logSingleton = new Log();
		
		return logSingleton;
	}


	public void write ( String msgError, String classError ){

		if(this.log.exists())
		{
			try
			{
				readLog(msgError, classError);
			}
			catch(IOException err)
			{
				err.printStackTrace();
			}
		}
		else
		{
			try{
				makeLog(msgError, classError);
			}
			catch(IOException io){
				io.printStackTrace();
			}
			
		}
	}

	private void makeLog(String msgError, String classError ) throws IOException{

		this.log.createNewFile();

		FileWriter writer = new FileWriter(this.log);

		writer.write("Problema:" + getMsgError()+"\n");
		writer.write("Classe:"+getClassError()+"\n");
		writer.write("Data:"+ new Date()+"\n");

		writer.close();
	}
	

	
	private void readLog(String msgError, String classError) throws IOException{
		
		FileReader reader = new FileReader(this.log);
		BufferedReader br = new BufferedReader(reader);
		String linha = br.readLine();
		FileWriter  writer = new FileWriter(this.log);

		while(linha != null)
		{
			writer.write(linha+"\n");
			br.readLine();
			linha = br.readLine();
		}

		br.close();
		reader.close();

		writer.write("Problema:" + msgError + "\n");
		writer.write("Classe:" + classError + "\n");
		writer.write("Data:"+ new Date());
		writer.close();
		System.out.println("Arquivo salvado");
	}


//	private String getMsgError() {
//		return msgError;
//	}
//
//
//	private String getClassError() {
//		return classError;
//	}


} 